import{r as c,j as e,C as N,S as B,U as F,V as L,W as O}from"./index-CsLBgfLF.js";import{u as _,A as K,T as $,a as G}from"./productStore-BN16QktZ.js";import{n as m,C as p,a as H,I as M,P as V,S as v,N as q,E as J,b as Q}from"./index.browser-BkvNv3uG.js";import{a as t,T as s,b as C,P as u}from"./Button-Bd078KDN.js";import{I as x}from"./IconButton-DasBNIRo.js";import{T as g,I as X}from"./TextField-CxOLwvla.js";import{S as o}from"./Stack-Ur0_A3jK.js";import{D as Y}from"./Delete-D82GHvm_.js";import"./useThemeProps-EEEnJN_H.js";import"./SwitchBase-B03KPz9u.js";import"./Select-BgqX2kQE.js";import"./isMuiElement-xdmmREXf.js";function he(){const{pushCategorytoDb:w,updateCategory:I,deleteCategory:k,categoryItems:S,fetchProducts:W}=_();c.useState(()=>{W()});const[d,f]=c.useState(null),[i,h]=c.useState({name:"",sku:"",id:m(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),a=(r,n)=>{h(l=>({...l,[r]:n}))},[R,j]=c.useState(!1),b=c.useRef(null),P=async r=>{const n=r.target.files?.[0];if(n){j(!0);try{const l=B(F,`categories/${m()}_${n.name}`),T=await L(l,n),U=await O(T.ref);h(E=>({...E,src:U}))}catch(l){console.error("Error uploading image: ",l),alert("Failed to upload image.")}finally{j(!1)}}},D=async()=>{try{const r={...i,name:i.name.trim(),category:i.name.trim()};if(console.log("Saving category...",r),!r.name||!r.src||!r.detail){alert("Please fill all details");return}d?(await I(r),alert("Category updated successfully!")):(await w(r),alert("Category saved successfully!")),y()}catch(r){console.error("Error saving category:",r),alert("Failed to save category")}},z=r=>{h({...r,categoryOnly:!0}),f(r.id),window.scrollTo({top:0,behavior:"smooth"})},A=async r=>{confirm("Are you sure you want to delete this category?")&&await k(r)},y=()=>{h({name:"",sku:"",id:m(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),f(null)};return e.jsxs(t,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(K,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs($,{children:[e.jsx(x,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(G,{})}),e.jsx(s,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:d?"Edit Category":"Add Category"}),d&&e.jsx(C,{color:"inherit",onClick:y,children:"Cancel Edit"})]})}),e.jsxs(p,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Category Image"}),e.jsx(g,{fullWidth:!0,placeholder:"Paste image URL or upload...",value:i.src,onChange:r=>a("src",r.target.value),InputProps:{endAdornment:e.jsxs(X,{position:"end",children:[e.jsx(x,{onClick:()=>b.current?.click(),edge:"end",children:R?e.jsx(N,{size:24}):e.jsx(H,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:b,accept:"image/*",onChange:P})]}),sx:{borderRadius:3}}}),e.jsx(t,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:i.src?e.jsx(t,{component:"img",src:i.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(M,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(s,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(o,{spacing:2,children:[e.jsxs(o,{direction:"row",spacing:2,children:[e.jsxs(t,{flex:1,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category Name"}),e.jsx(g,{fullWidth:!0,placeholder:"Category Label",value:i.name,onChange:r=>{a("name",r.target.value),a("category",r.target.value)}})]}),e.jsxs(t,{width:140,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(g,{fullWidth:!0,placeholder:"CAT-001",value:i.sku||"",onChange:r=>a("sku",r.target.value)})]})]}),e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(g,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the category features...",value:i.detail,onChange:r=>a("detail",r.target.value)})]})]}),e.jsx(t,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(u,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(o,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(V,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"On Sale"})]}),e.jsx(v,{checked:i.sale,onChange:r=>a("sale",r.target.checked)})]}),e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(q,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"New Arrival"})]}),e.jsx(v,{checked:i.isNew,onChange:r=>a("isNew",r.target.checked)})]})]})]}),e.jsx(p,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(t,{sx:{mt:4},children:[e.jsx(s,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Manage Categories"}),e.jsx(o,{spacing:2,children:S.map(r=>e.jsx(u,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(o,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{component:"img",src:r.src||"",sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}),e.jsxs(t,{flex:1,children:[e.jsx(s,{fontWeight:600,children:r.name}),e.jsx(o,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(s,{variant:"caption",color:"text.secondary",children:r.detail})}),r.sku&&e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",r.sku]})]}),e.jsx(x,{size:"small",onClick:()=>z(r),children:e.jsx(J,{})}),e.jsx(x,{size:"small",color:"error",onClick:()=>A(r.id),children:e.jsx(Y,{})})]})},r.id))})]})}),e.jsx(u,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(p,{maxWidth:"sm",children:e.jsx(C,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(Q,{}),onClick:D,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:d?"Update Category":"Save Category"})})})]})}export{he as component};
